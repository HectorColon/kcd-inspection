!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("d3")):"function"==typeof define&&define.amd?define("ng-whiteboard",["exports","@angular/core","rxjs","d3"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ng-whiteboard"]={},e.ng.core,e.rxjs,e.d3)}(this,(function(e,t,i,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var r=o(t),s=function(){this.color="#000000",this.backgroundColor="#ffffff",this.size="5px",this.linejoin="round",this.linecap="round"};var a={Line:0,Image:1};a[a.Line]="Line",a[a.Image]="Image";var c={Png:"png",Jpeg:"jpeg",Svg:"svg",Base64:"base64"},h=function(){function e(){this.eraseSvgMethodCallSource=new i.Subject,this.saveSvgMethodCallSource=new i.Subject,this.undoSvgMethodCallSource=new i.Subject,this.redoSvgMethodCallSource=new i.Subject,this.addImageMethodCallSource=new i.Subject,this.eraseSvgMethodCalled$=this.eraseSvgMethodCallSource.asObservable(),this.saveSvgMethodCalled$=this.saveSvgMethodCallSource.asObservable(),this.undoSvgMethodCalled$=this.undoSvgMethodCallSource.asObservable(),this.redoSvgMethodCalled$=this.redoSvgMethodCallSource.asObservable(),this.addImageMethodCalled$=this.addImageMethodCallSource.asObservable()}return e.prototype.erase=function(){this.eraseSvgMethodCallSource.next()},e.prototype.save=function(e,t){void 0===e&&(e=c.Png),void 0===t&&(t="New image"),this.saveSvgMethodCallSource.next({name:t,format:e})},e.prototype.undo=function(){this.undoSvgMethodCallSource.next()},e.prototype.redo=function(){this.redoSvgMethodCallSource.next()},e.prototype.addImage=function(e){this.addImageMethodCallSource.next(e)},e}();h.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],h.ɵprov=r.ɵɵdefineInjectable({factory:function(){return new h},token:h,providedIn:"root"});var d=function(){function e(e){this.whiteboardService=e,this.whiteboardOptions=new s,this.init=new t.EventEmitter,this.clear=new t.EventEmitter,this.undo=new t.EventEmitter,this.redo=new t.EventEmitter,this.save=new t.EventEmitter,this.imageAdded=new t.EventEmitter,this.selection=void 0,this.subscriptionList=[],this.undoStack=[],this.redoStack=[]}return e.prototype.ngAfterViewInit=function(){var e=this;this.subscriptionList.push(this.whiteboardService.eraseSvgMethodCalled$.subscribe((function(){return e.eraseSvg(e.selection)}))),this.subscriptionList.push(this.whiteboardService.saveSvgMethodCalled$.subscribe((function(t){var i=t.name,n=t.format;return e.saveSvg(i,n)}))),this.subscriptionList.push(this.whiteboardService.undoSvgMethodCalled$.subscribe((function(){return e.undoDraw()}))),this.subscriptionList.push(this.whiteboardService.redoSvgMethodCalled$.subscribe((function(){return e.redoDraw()}))),this.subscriptionList.push(this.whiteboardService.addImageMethodCalled$.subscribe((function(t){return e.addImage(t)}))),this.selection=this.initSvg(this.svgContainer.nativeElement)},e.prototype.ngOnDestroy=function(){var e=this;this.subscriptionList.forEach((function(t){return e._unsubscribe(t)}))},e.prototype.initSvg=function(e){var t=this,i=n.line().curve(n.curveBasis),o=n.select(e).call(n.drag().container(e).subject((function(){var e=[n.event.x,n.event.y];return[e,e]})).on("start",(function(){var e=n.event.subject,r=o.append("path").datum(e).attr("class","line").attr("style","\n           fill: none;\n           stroke: "+(t.color||t.whiteboardOptions.color)+";\n           stroke-width: "+(t.size||t.whiteboardOptions.size)+";\n           stroke-linejoin: "+(t.linejoin||t.whiteboardOptions.linejoin)+";\n           stroke-linecap: "+(t.linecap||t.whiteboardOptions.linecap)+";\n           ");r.attr("d",i),n.event.on("drag",(function(){r.datum().push(n.mouse(this)),r.attr("d",i)})),n.event.on("end",(function(){r.attr("d",i),t.undoStack.length<1&&(t.redoStack=[]),t.undoStack.push({type:a.Line,line:r.node()})}))})));return this.init.emit(),o},e.prototype.addImage=function(e){this.drawImage(e)},e.prototype.eraseSvg=function(e){e.selectAll("*").remove(),this.undoStack=[],this.redoStack=[],this.clear.emit()},e.prototype.saveSvg=function(e,t){var i=this,n=this.saveAsSvg(this.selection.clone(!0).node());switch(t){case c.Base64:this.svgString2Image(n,Number(this.selection.style("width").replace("px","")),Number(this.selection.style("height").replace("px","")),t,(function(e){i.save.emit(e)}));break;case c.Svg:var o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)));this.download(o,e),this.save.emit(o);break;default:this.svgString2Image(n,Number(this.selection.style("width").replace("px","")),Number(this.selection.style("height").replace("px","")),t,(function(t){i.download(t,e),i.save.emit(t)}))}},e.prototype.undoDraw=function(){var e=this;this.undoStack.length&&(this.redoStack.push(this.undoStack.pop()),this.selection.selectAll(".line").remove(),this.undoStack.forEach((function(t){t.type===a.Line?e.drawLine(t.line):t.type===a.Image&&e.drawLine(t.image)})),this.undo.emit())},e.prototype.redoDraw=function(){var e=this;this.redoStack.length&&(this.undoStack.push(this.redoStack.pop()),this.selection.selectAll(".line").remove(),this.undoStack.forEach((function(t){t.type===a.Line?e.drawLine(t.line):t.type===a.Image&&e.drawLine(t.image)})),this.redo.emit())},e.prototype.drawLine=function(e){this.selection.node().appendChild(e)},e.prototype.drawImage=function(e){var t=this,i=this.selection.append("g").data([{x:20,y:20,r:1,scale:1}]).attr("x",0).attr("y",0).attr("transform","translate(0,0)"),o=new Image;o.onload=function(){var r=o.width/o.height,s=o.height>Number(t.selection.style("height").replace("px",""))?Number(t.selection.style("height").replace("px",""))-40:o.height,a=s===Number(t.selection.style("height").replace("px",""))-40?(Number(t.selection.style("height").replace("px",""))-40)*r:o.width;i.append("image").attr("x",0).attr("y",0).attr("height",s).attr("width",a).attr("preserveAspectRatio","none").attr("xlink:href",e.toString()),i.append("rect").attr("x",0).attr("y",0).attr("width",20).attr("height",20).style("opacity",0).attr("fill",(function(e){return"#cccccc"})).call(n.drag().subject((function(){var e=[n.event.x,n.event.y];return[e,e]})).on("start",(function(){n.event.on("drag",(function(e){var t=n.select(this),i=n.mouse(this);e.x+=i[0]-Number(t.attr("width"))/2,e.y+=i[1]-Number(t.attr("height"))/2,n.select(this.parentNode).attr("transform",(function(){return"translate("+[e.x,e.y]+"),rotate(0,160, 160),scale("+e.scale+","+e.scale+")"}))}))}))),i.on("mouseover",(function(){n.select(this).select("rect").style("opacity",1)})).on("mouseout",(function(){n.select(this).select("rect").style("opacity",0)}))},o.src=e.toString()},e.prototype._unsubscribe=function(e){e&&e.unsubscribe()},e.prototype.svgString2Image=function(e,t,i,n,o){n=n||"png";var r="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e))),s=document.createElement("canvas"),a=s.getContext("2d");s.width=t,s.height=i;var c=new Image;c.onload=function(){a.clearRect(0,0,t,i),a.drawImage(c,0,0,t,i);var e=s.toDataURL("image/"+n);o(e)},c.src=r},e.prototype.saveAsSvg=function(e){e.setAttribute("xlink","http://www.w3.org/1999/xlink"),e.setAttribute("width",Number(this.selection.style("width").replace("px",""))),e.setAttribute("height",Number(this.selection.style("height").replace("px","")));var t=(new XMLSerializer).serializeToString(e);return t=(t=t.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")},e.prototype.download=function(e,t){var i=document.createElement("a");i.href=e,i.setAttribute("visibility","hidden"),i.download=t||"new white-board",document.body.appendChild(i),i.click()},e}();d.decorators=[{type:t.Component,args:[{selector:"ng-whiteboard",template:'\n    <svg #svgContainer [style.background-color]="this.backgroundColor || this.whiteboardOptions.backgroundColor"></svg>\n  ',styles:[':host,:host svg{height:inherit;max-height:inherit;max-width:inherit;min-height:inherit;min-width:inherit;width:inherit}:host svg{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;background-position:50%;background-repeat:no-repeat;background-size:cover;cursor:url("data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 height%3D%2220%22 width%3D%2220%22%3E  %3Ccircle cx%3D%225%22 cy%3D%225%22 r%3D%225%22 style%3D%22fill%3A none%3B stroke%3A %235a5a5a%3B stroke-width%3A .02em%3B%22 %2F%3E%3C%2Fsvg%3E") 5 5,crosshair;user-select:none}:host svg .bg-image{position:relative}:host svg .bg-image .image-cursor{background-color:#080;height:10px;position:absolute;right:0;top:0;width:10px}']}]}],d.ctorParameters=function(){return[{type:h}]},d.propDecorators={svgContainer:[{type:t.ViewChild,args:["svgContainer",{static:!1}]}],whiteboardOptions:[{type:t.Input}],color:[{type:t.Input}],backgroundColor:[{type:t.Input}],size:[{type:t.Input}],linejoin:[{type:t.Input}],linecap:[{type:t.Input}],init:[{type:t.Output}],clear:[{type:t.Output}],undo:[{type:t.Output}],redo:[{type:t.Output}],save:[{type:t.Output}],imageAdded:[{type:t.Output}]};var u=function(){};u.decorators=[{type:t.NgModule,args:[{declarations:[d],imports:[],exports:[d]}]}],e.ActionType=a,e.FormatType=c,e.NgWhiteboardComponent=d,e.NgWhiteboardModule=u,e.NgWhiteboardService=h,e.WhiteboardOptions=s,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-whiteboard.umd.min.js.map