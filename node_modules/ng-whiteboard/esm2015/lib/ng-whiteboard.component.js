/**
 * @fileoverview added by tsickle
 * Generated from: lib/ng-whiteboard.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Input, ElementRef, Output, EventEmitter } from '@angular/core';
import { NgWhiteboardService } from './ng-whiteboard.service';
import { WhiteboardOptions, ActionType, FormatType } from './ng-whiteboard.types';
import { curveBasis, select, drag, line, event, mouse } from 'd3';
export class NgWhiteboardComponent {
    /**
     * @param {?} whiteboardService
     */
    constructor(whiteboardService) {
        this.whiteboardService = whiteboardService;
        this.whiteboardOptions = new WhiteboardOptions();
        this.init = new EventEmitter();
        this.clear = new EventEmitter();
        this.undo = new EventEmitter();
        this.redo = new EventEmitter();
        this.save = new EventEmitter();
        this.imageAdded = new EventEmitter();
        this.selection = undefined;
        this.subscriptionList = [];
        this.undoStack = [];
        this.redoStack = [];
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.subscriptionList.push(this.whiteboardService.eraseSvgMethodCalled$.subscribe((/**
         * @return {?}
         */
        () => this.eraseSvg(this.selection))));
        this.subscriptionList.push(this.whiteboardService.saveSvgMethodCalled$.subscribe((/**
         * @param {?} __0
         * @return {?}
         */
        ({ name, format }) => this.saveSvg(name, format))));
        this.subscriptionList.push(this.whiteboardService.undoSvgMethodCalled$.subscribe((/**
         * @return {?}
         */
        () => this.undoDraw())));
        this.subscriptionList.push(this.whiteboardService.redoSvgMethodCalled$.subscribe((/**
         * @return {?}
         */
        () => this.redoDraw())));
        this.subscriptionList.push(this.whiteboardService.addImageMethodCalled$.subscribe((/**
         * @param {?} image
         * @return {?}
         */
        (image) => this.addImage(image))));
        this.selection = this.initSvg(this.svgContainer.nativeElement);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscriptionList.forEach((/**
         * @param {?} subscription
         * @return {?}
         */
        (subscription) => this._unsubscribe(subscription)));
    }
    /**
     * @private
     * @param {?} selector
     * @return {?}
     */
    initSvg(selector) {
        /** @type {?} */
        const d3Line = line().curve(curveBasis);
        /** @type {?} */
        const svg = select(selector).call(drag()
            .container(selector)
            .subject((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const p = [event.x, event.y];
            return [p, p];
        }))
            .on('start', (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const d = event.subject;
            /** @type {?} */
            const active = svg
                .append('path')
                .datum(d)
                .attr('class', 'line')
                .attr('style', `
           fill: none;
           stroke: ${this.color || this.whiteboardOptions.color};
           stroke-width: ${this.size || this.whiteboardOptions.size};
           stroke-linejoin: ${this.linejoin || this.whiteboardOptions.linejoin};
           stroke-linecap: ${this.linecap || this.whiteboardOptions.linecap};
           `);
            active.attr('d', d3Line);
            event.on('drag', (/**
             * @return {?}
             */
            function () {
                active.datum().push(mouse(this));
                active.attr('d', d3Line);
            }));
            event.on('end', (/**
             * @return {?}
             */
            () => {
                active.attr('d', d3Line);
                if (this.undoStack.length < 1) {
                    this.redoStack = [];
                }
                this.undoStack.push({ type: ActionType.Line, line: active.node() });
            }));
        })));
        this.init.emit();
        return svg;
    }
    /**
     * @private
     * @param {?} image
     * @return {?}
     */
    addImage(image) {
        this.drawImage(image);
    }
    /**
     * @private
     * @param {?} svg
     * @return {?}
     */
    eraseSvg(svg) {
        svg.selectAll('*').remove();
        this.undoStack = [];
        this.redoStack = [];
        this.clear.emit();
    }
    /**
     * @private
     * @param {?} name
     * @param {?} format
     * @return {?}
     */
    saveSvg(name, format) {
        /** @type {?} */
        const svgString = this.saveAsSvg(this.selection.clone(true).node());
        switch (format) {
            case FormatType.Base64:
                this.svgString2Image(svgString, Number(this.selection.style('width').replace('px', '')), Number(this.selection.style('height').replace('px', '')), format, (/**
                 * @param {?} img
                 * @return {?}
                 */
                (img) => {
                    this.save.emit(img);
                }));
                break;
            case FormatType.Svg:
                /** @type {?} */
                const imgSrc = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
                this.download(imgSrc, name);
                this.save.emit(imgSrc);
                break;
            default:
                this.svgString2Image(svgString, Number(this.selection.style('width').replace('px', '')), Number(this.selection.style('height').replace('px', '')), format, (/**
                 * @param {?} img
                 * @return {?}
                 */
                (img) => {
                    this.download(img, name);
                    this.save.emit(img);
                }));
                break;
        }
    }
    /**
     * @private
     * @return {?}
     */
    undoDraw() {
        if (!this.undoStack.length) {
            return;
        }
        this.redoStack.push(this.undoStack.pop());
        this.selection.selectAll('.line').remove();
        this.undoStack.forEach((/**
         * @param {?} action
         * @return {?}
         */
        (action) => {
            if (action.type === ActionType.Line) {
                this.drawLine(action.line);
            }
            else if (action.type === ActionType.Image) {
                this.drawLine(action.image);
            }
        }));
        this.undo.emit();
    }
    /**
     * @private
     * @return {?}
     */
    redoDraw() {
        if (!this.redoStack.length) {
            return;
        }
        this.undoStack.push(this.redoStack.pop());
        this.selection.selectAll('.line').remove();
        this.undoStack.forEach((/**
         * @param {?} action
         * @return {?}
         */
        (action) => {
            if (action.type === ActionType.Line) {
                this.drawLine(action.line);
            }
            else if (action.type === ActionType.Image) {
                this.drawLine(action.image);
            }
        }));
        this.redo.emit();
    }
    /**
     * @private
     * @param {?} pathNode
     * @return {?}
     */
    drawLine(pathNode) {
        this.selection.node().appendChild(pathNode);
    }
    /**
     * @private
     * @param {?} image
     * @return {?}
     */
    drawImage(image) {
        /** @type {?} */
        const group = this.selection
            .append('g')
            .data([{ x: 20, y: 20, r: 1, scale: 1 }])
            .attr('x', 0)
            .attr('y', 0)
            .attr('transform', 'translate(0,0)');
        /** @type {?} */
        const tempImg = new Image();
        tempImg.onload = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const aspectRatio = tempImg.width / tempImg.height;
            /** @type {?} */
            const height = tempImg.height > Number(this.selection.style('height').replace('px', ''))
                ? Number(this.selection.style('height').replace('px', '')) - 40
                : tempImg.height;
            /** @type {?} */
            const width = height === Number(this.selection.style('height').replace('px', '')) - 40
                ? (Number(this.selection.style('height').replace('px', '')) - 40) * aspectRatio
                : tempImg.width;
            group
                .append('image')
                .attr('x', 0)
                .attr('y', 0)
                .attr('height', height)
                .attr('width', width)
                .attr('preserveAspectRatio', 'none')
                .attr('xlink:href', image.toString());
            group
                .append('rect')
                .attr('x', 0)
                .attr('y', 0)
                .attr('width', 20)
                .attr('height', 20)
                .style('opacity', 0)
                .attr('fill', (/**
             * @param {?} d
             * @return {?}
             */
            (d) => {
                return '#cccccc';
            }))
                .call(drag()
                .subject((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const p = [event.x, event.y];
                return [p, p];
            }))
                .on('start', (/**
             * @return {?}
             */
            () => {
                event.on('drag', (/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) {
                    /** @type {?} */
                    const cursor = select(this);
                    /** @type {?} */
                    const cord = mouse(this);
                    d.x += cord[0] - Number(cursor.attr('width')) / 2;
                    d.y += cord[1] - Number(cursor.attr('height')) / 2;
                    select(this.parentNode).attr('transform', (/**
                     * @return {?}
                     */
                    () => {
                        return ('translate(' + [d.x, d.y] + '),rotate(' + 0 + ',160, 160),scale(' + d.scale + ',' + d.scale + ')');
                    }));
                }));
            })));
            group
                .on('mouseover', (/**
             * @return {?}
             */
            function () {
                select(this).select('rect').style('opacity', 1.0);
            }))
                .on('mouseout', (/**
             * @return {?}
             */
            function () {
                select(this).select('rect').style('opacity', 0);
            }));
            // this.undoStack.push({ type: ActionType.Image, image: group.node() });
        });
        tempImg.src = image.toString();
    }
    /**
     * @private
     * @param {?} subscription
     * @return {?}
     */
    _unsubscribe(subscription) {
        if (subscription) {
            subscription.unsubscribe();
        }
    }
    /**
     * @private
     * @param {?} svgString
     * @param {?} width
     * @param {?} height
     * @param {?} format
     * @param {?} callback
     * @return {?}
     */
    svgString2Image(svgString, width, height, format, callback) {
        // set default for format parameter
        format = format || 'png';
        // SVG data URL from SVG string
        /** @type {?} */
        const svgData = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
        // create canvas in memory(not in DOM)
        /** @type {?} */
        const canvas = document.createElement('canvas');
        // get canvas context for drawing on canvas
        /** @type {?} */
        const context = canvas.getContext('2d');
        // set canvas size
        canvas.width = width;
        canvas.height = height;
        // create image in memory(not in DOM)
        /** @type {?} */
        const image = new Image();
        // later when image loads run this
        image.onload = (/**
         * @return {?}
         */
        () => {
            // async (happens later)
            // clear canvas
            context.clearRect(0, 0, width, height);
            // draw image with SVG data to canvas
            context.drawImage(image, 0, 0, width, height);
            // snapshot canvas as png
            /** @type {?} */
            const pngData = canvas.toDataURL('image/' + format);
            // pass png data URL to callback
            callback(pngData);
        }); // end async
        // start loading SVG data into in memory image
        image.src = svgData;
    }
    /**
     * @private
     * @param {?} svgNode
     * @return {?}
     */
    saveAsSvg(svgNode) {
        svgNode.setAttribute('xlink', 'http://www.w3.org/1999/xlink');
        // Set width and height for svg element
        svgNode.setAttribute('width', Number(this.selection.style('width').replace('px', '')));
        svgNode.setAttribute('height', Number(this.selection.style('height').replace('px', '')));
        /** @type {?} */
        const serializer = new XMLSerializer();
        /** @type {?} */
        let svgString = serializer.serializeToString(svgNode);
        svgString = svgString.replace(/(\w+)?:?xlink=/g, 'xmlns:xlink='); // Fix root xlink without namespace
        svgString = svgString.replace(/NS\d+:href/g, 'xlink:href');
        return svgString;
    }
    /**
     * @private
     * @param {?} url
     * @param {?} name
     * @return {?}
     */
    download(url, name) {
        /** @type {?} */
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('visibility', 'hidden');
        link.download = name || 'new white-board';
        document.body.appendChild(link);
        link.click();
    }
}
NgWhiteboardComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line: component-selector
                selector: 'ng-whiteboard',
                template: `
    <svg #svgContainer [style.background-color]="this.backgroundColor || this.whiteboardOptions.backgroundColor"></svg>
  `,
                styles: [":host,:host svg{height:inherit;max-height:inherit;max-width:inherit;min-height:inherit;min-width:inherit;width:inherit}:host svg{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;background-position:50%;background-repeat:no-repeat;background-size:cover;cursor:url(\"data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 height%3D%2220%22 width%3D%2220%22%3E  %3Ccircle cx%3D%225%22 cy%3D%225%22 r%3D%225%22 style%3D%22fill%3A none%3B stroke%3A %235a5a5a%3B stroke-width%3A .02em%3B%22 %2F%3E%3C%2Fsvg%3E\") 5 5,crosshair;user-select:none}:host svg .bg-image{position:relative}:host svg .bg-image .image-cursor{background-color:#080;height:10px;position:absolute;right:0;top:0;width:10px}"]
            }] }
];
/** @nocollapse */
NgWhiteboardComponent.ctorParameters = () => [
    { type: NgWhiteboardService }
];
NgWhiteboardComponent.propDecorators = {
    svgContainer: [{ type: ViewChild, args: ['svgContainer', { static: false },] }],
    whiteboardOptions: [{ type: Input }],
    color: [{ type: Input }],
    backgroundColor: [{ type: Input }],
    size: [{ type: Input }],
    linejoin: [{ type: Input }],
    linecap: [{ type: Input }],
    init: [{ type: Output }],
    clear: [{ type: Output }],
    undo: [{ type: Output }],
    redo: [{ type: Output }],
    save: [{ type: Output }],
    imageAdded: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgWhiteboardComponent.prototype.svgContainer;
    /** @type {?} */
    NgWhiteboardComponent.prototype.whiteboardOptions;
    /** @type {?} */
    NgWhiteboardComponent.prototype.color;
    /** @type {?} */
    NgWhiteboardComponent.prototype.backgroundColor;
    /** @type {?} */
    NgWhiteboardComponent.prototype.size;
    /** @type {?} */
    NgWhiteboardComponent.prototype.linejoin;
    /** @type {?} */
    NgWhiteboardComponent.prototype.linecap;
    /** @type {?} */
    NgWhiteboardComponent.prototype.init;
    /** @type {?} */
    NgWhiteboardComponent.prototype.clear;
    /** @type {?} */
    NgWhiteboardComponent.prototype.undo;
    /** @type {?} */
    NgWhiteboardComponent.prototype.redo;
    /** @type {?} */
    NgWhiteboardComponent.prototype.save;
    /** @type {?} */
    NgWhiteboardComponent.prototype.imageAdded;
    /**
     * @type {?}
     * @private
     */
    NgWhiteboardComponent.prototype.selection;
    /**
     * @type {?}
     * @private
     */
    NgWhiteboardComponent.prototype.subscriptionList;
    /**
     * @type {?}
     * @private
     */
    NgWhiteboardComponent.prototype.undoStack;
    /**
     * @type {?}
     * @private
     */
    NgWhiteboardComponent.prototype.redoStack;
    /**
     * @type {?}
     * @private
     */
    NgWhiteboardComponent.prototype.whiteboardService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctd2hpdGVib2FyZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL21vc3RhZmF6a2Uvbmctd2hpdGVib2FyZC9wcm9qZWN0cy9uZy13aGl0ZWJvYXJkL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9uZy13aGl0ZWJvYXJkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWlCLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFhLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFOUQsT0FBTyxFQUFFLGlCQUFpQixFQUFlLFVBQVUsRUFBRSxVQUFVLEVBQWUsTUFBTSx1QkFBdUIsQ0FBQztBQUM1RyxPQUFPLEVBQW9CLFVBQVUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFhLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBVS9GLE1BQU0sT0FBTyxxQkFBcUI7Ozs7SUF1QmhDLFlBQW9CLGlCQUFzQztRQUF0QyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQXFCO1FBckJqRCxzQkFBaUIsR0FBc0IsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1FBTzlELFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzFCLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzNCLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzFCLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzFCLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBaUIsQ0FBQztRQUN6QyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVsQyxjQUFTLEdBQTZDLFNBQVMsQ0FBQztRQUVoRSxxQkFBZ0IsR0FBbUIsRUFBRSxDQUFDO1FBRXRD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ekIsUUFBUSxFQUFFOztHQUVUOzthQUVGOzs7O1lBWlEsbUJBQW1COzs7MkJBY3pCLFNBQVMsU0FBQyxjQUFjLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO2dDQUMzQyxLQUFLO29CQUNMLEtBQUs7OEJBQ0wsS0FBSzttQkFDTCxLQUFLO3VCQUNMLEtBQUs7c0JBQ0wsS0FBSzttQkFFTCxNQUFNO29CQUNOLE1BQU07bUJBQ04sTUFBTTttQkFDTixNQUFNO21CQUNOLE1BQU07eUJBQ04sTUFBTTs7Ozs7OztJQWJQLDZDQUFpRzs7SUFDakcsa0RBQXdFOztJQUN4RSxzQ0FBdUI7O0lBQ3ZCLGdEQUFpQzs7SUFDakMscUNBQXNCOztJQUN0Qix5Q0FBdUU7O0lBQ3ZFLHdDQUE4Qzs7SUFFOUMscUNBQW9DOztJQUNwQyxzQ0FBcUM7O0lBQ3JDLHFDQUFvQzs7SUFDcEMscUNBQW9DOztJQUNwQyxxQ0FBbUQ7O0lBQ25ELDJDQUEwQzs7Ozs7SUFFMUMsMENBQXdFOzs7OztJQUV4RSxpREFBOEM7Ozs7O0lBRTlDLDBDQUFzQzs7Ozs7SUFDdEMsMENBQXNDOzs7OztJQUUxQixrREFBOEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgSW5wdXQsIEVsZW1lbnRSZWYsIE9uRGVzdHJveSwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nV2hpdGVib2FyZFNlcnZpY2UgfSBmcm9tICcuL25nLXdoaXRlYm9hcmQuc2VydmljZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFdoaXRlYm9hcmRPcHRpb25zLCBBY3Rpb25TdGFjaywgQWN0aW9uVHlwZSwgRm9ybWF0VHlwZSwgZm9ybWF0VHlwZXMgfSBmcm9tICcuL25nLXdoaXRlYm9hcmQudHlwZXMnO1xuaW1wb3J0IHsgQ29udGFpbmVyRWxlbWVudCwgY3VydmVCYXNpcywgc2VsZWN0LCBkcmFnLCBTZWxlY3Rpb24sIGxpbmUsIGV2ZW50LCBtb3VzZSB9IGZyb20gJ2QzJztcblxuQENvbXBvbmVudCh7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogY29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnbmctd2hpdGVib2FyZCcsXG4gIHRlbXBsYXRlOiBgXG4gICAgPHN2ZyAjc3ZnQ29udGFpbmVyIFtzdHlsZS5iYWNrZ3JvdW5kLWNvbG9yXT1cInRoaXMuYmFja2dyb3VuZENvbG9yIHx8IHRoaXMud2hpdGVib2FyZE9wdGlvbnMuYmFja2dyb3VuZENvbG9yXCI+PC9zdmc+XG4gIGAsXG4gIHN0eWxlVXJsczogWyduZy13aGl0ZWJvYXJkLmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIE5nV2hpdGVib2FyZENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGQoJ3N2Z0NvbnRhaW5lcicsIHsgc3RhdGljOiBmYWxzZSB9KSBwcml2YXRlIHN2Z0NvbnRhaW5lcjogRWxlbWVudFJlZjxDb250YWluZXJFbGVtZW50PjtcbiAgQElucHV0KCkgd2hpdGVib2FyZE9wdGlvbnM6IFdoaXRlYm9hcmRPcHRpb25zID0gbmV3IFdoaXRlYm9hcmRPcHRpb25zKCk7XG4gIEBJbnB1dCgpIGNvbG9yOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGJhY2tncm91bmRDb2xvcjogc3RyaW5nO1xuICBASW5wdXQoKSBzaXplOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGxpbmVqb2luOiAnbWl0ZXInIHwgJ3JvdW5kJyB8ICdiZXZlbCcgfCAnbWl0ZXItY2xpcCcgfCAnYXJjcyc7XG4gIEBJbnB1dCgpIGxpbmVjYXA6ICdidXR0JyB8ICdzcXVhcmUnIHwgJ3JvdW5kJztcblxuICBAT3V0cHV0KCkgaW5pdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGNsZWFyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgdW5kbyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHJlZG8gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBzYXZlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmcgfCBCbG9iPigpO1xuICBAT3V0cHV0KCkgaW1hZ2VBZGRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwcml2YXRlIHNlbGVjdGlvbjogU2VsZWN0aW9uPGFueSwgdW5rbm93biwgbnVsbCwgdW5kZWZpbmVkPiA9IHVuZGVmaW5lZDtcblxuICBwcml2YXRlIHN1YnNjcmlwdGlvbkxpc3Q6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbiAgcHJpdmF0ZSB1bmRvU3RhY2s6IEFjdGlvblN0YWNrW10gPSBbXTtcbiAgcHJpdmF0ZSByZWRvU3RhY2s6IEFjdGlvblN0YWNrW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHdoaXRlYm9hcmRTZXJ2aWNlOiBOZ1doaXRlYm9hcmRTZXJ2aWNlKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbkxpc3QucHVzaChcbiAgICAgIHRoaXMud2hpdGVib2FyZFNlcnZpY2UuZXJhc2VTdmdNZXRob2RDYWxsZWQkLnN1YnNjcmliZSgoKSA9PiB0aGlzLmVyYXNlU3ZnKHRoaXMuc2VsZWN0aW9uKSlcbiAgICApO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb25MaXN0LnB1c2goXG4gICAgICB0aGlzLndoaXRlYm9hcmRTZXJ2aWNlLnNhdmVTdmdNZXRob2RDYWxsZWQkLnN1YnNjcmliZSgoeyBuYW1lLCBmb3JtYXQgfSkgPT4gdGhpcy5zYXZlU3ZnKG5hbWUsIGZvcm1hdCkpXG4gICAgKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbkxpc3QucHVzaCh0aGlzLndoaXRlYm9hcmRTZXJ2aWNlLnVuZG9TdmdNZXRob2RDYWxsZWQkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnVuZG9EcmF3KCkpKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbkxpc3QucHVzaCh0aGlzLndoaXRlYm9hcmRTZXJ2aWNlLnJlZG9TdmdNZXRob2RDYWxsZWQkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnJlZG9EcmF3KCkpKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbkxpc3QucHVzaCh0aGlzLndoaXRlYm9hcmRTZXJ2aWNlLmFkZEltYWdlTWV0aG9kQ2FsbGVkJC5zdWJzY3JpYmUoKGltYWdlKSA9PiB0aGlzLmFkZEltYWdlKGltYWdlKSkpO1xuXG4gICAgdGhpcy5zZWxlY3Rpb24gPSB0aGlzLmluaXRTdmcodGhpcy5zdmdDb250YWluZXIubmF0aXZlRWxlbWVudCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbkxpc3QuZm9yRWFjaCgoc3Vic2NyaXB0aW9uKSA9PiB0aGlzLl91bnN1YnNjcmliZShzdWJzY3JpcHRpb24pKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFN2ZyhzZWxlY3RvcjogQ29udGFpbmVyRWxlbWVudCkge1xuICAgIGNvbnN0IGQzTGluZSA9IGxpbmUoKS5jdXJ2ZShjdXJ2ZUJhc2lzKTtcbiAgICBjb25zdCBzdmcgPSBzZWxlY3Qoc2VsZWN0b3IpLmNhbGwoXG4gICAgICBkcmFnKClcbiAgICAgICAgLmNvbnRhaW5lcihzZWxlY3RvcilcbiAgICAgICAgLnN1YmplY3QoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHAgPSBbZXZlbnQueCwgZXZlbnQueV07XG4gICAgICAgICAgcmV0dXJuIFtwLCBwXTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uKCdzdGFydCcsICgpID0+IHtcbiAgICAgICAgICBjb25zdCBkID0gZXZlbnQuc3ViamVjdDtcbiAgICAgICAgICBjb25zdCBhY3RpdmUgPSBzdmdcbiAgICAgICAgICAgIC5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAgICAgLmRhdHVtKGQpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGluZScpXG4gICAgICAgICAgICAuYXR0cihcbiAgICAgICAgICAgICAgJ3N0eWxlJyxcbiAgICAgICAgICAgICAgYFxuICAgICAgICAgICBmaWxsOiBub25lO1xuICAgICAgICAgICBzdHJva2U6ICR7dGhpcy5jb2xvciB8fCB0aGlzLndoaXRlYm9hcmRPcHRpb25zLmNvbG9yfTtcbiAgICAgICAgICAgc3Ryb2tlLXdpZHRoOiAke3RoaXMuc2l6ZSB8fCB0aGlzLndoaXRlYm9hcmRPcHRpb25zLnNpemV9O1xuICAgICAgICAgICBzdHJva2UtbGluZWpvaW46ICR7dGhpcy5saW5lam9pbiB8fCB0aGlzLndoaXRlYm9hcmRPcHRpb25zLmxpbmVqb2lufTtcbiAgICAgICAgICAgc3Ryb2tlLWxpbmVjYXA6ICR7dGhpcy5saW5lY2FwIHx8IHRoaXMud2hpdGVib2FyZE9wdGlvbnMubGluZWNhcH07XG4gICAgICAgICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgYWN0aXZlLmF0dHIoJ2QnLCBkM0xpbmUpO1xuICAgICAgICAgIGV2ZW50Lm9uKCdkcmFnJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgYWN0aXZlLmRhdHVtKCkucHVzaChtb3VzZSh0aGlzKSk7XG4gICAgICAgICAgICBhY3RpdmUuYXR0cignZCcsIGQzTGluZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXZlbnQub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgIGFjdGl2ZS5hdHRyKCdkJywgZDNMaW5lKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnVuZG9TdGFjay5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICAgIHRoaXMucmVkb1N0YWNrID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVuZG9TdGFjay5wdXNoKHsgdHlwZTogQWN0aW9uVHlwZS5MaW5lLCBsaW5lOiBhY3RpdmUubm9kZSgpIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICk7XG4gICAgdGhpcy5pbml0LmVtaXQoKTtcbiAgICByZXR1cm4gc3ZnO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRJbWFnZShpbWFnZTogc3RyaW5nIHwgQXJyYXlCdWZmZXIpIHtcbiAgICB0aGlzLmRyYXdJbWFnZShpbWFnZSk7XG4gIH1cblxuICBwcml2YXRlIGVyYXNlU3ZnKHN2ZzogU2VsZWN0aW9uPGFueSwgdW5rbm93biwgbnVsbCwgdW5kZWZpbmVkPikge1xuICAgIHN2Zy5zZWxlY3RBbGwoJyonKS5yZW1vdmUoKTtcbiAgICB0aGlzLnVuZG9TdGFjayA9IFtdO1xuICAgIHRoaXMucmVkb1N0YWNrID0gW107XG4gICAgdGhpcy5jbGVhci5lbWl0KCk7XG4gIH1cblxuICBwcml2YXRlIHNhdmVTdmcobmFtZSwgZm9ybWF0OiBmb3JtYXRUeXBlcykge1xuICAgIGNvbnN0IHN2Z1N0cmluZyA9IHRoaXMuc2F2ZUFzU3ZnKHRoaXMuc2VsZWN0aW9uLmNsb25lKHRydWUpLm5vZGUoKSk7XG4gICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgIGNhc2UgRm9ybWF0VHlwZS5CYXNlNjQ6XG4gICAgICAgIHRoaXMuc3ZnU3RyaW5nMkltYWdlKFxuICAgICAgICAgIHN2Z1N0cmluZyxcbiAgICAgICAgICBOdW1iZXIodGhpcy5zZWxlY3Rpb24uc3R5bGUoJ3dpZHRoJykucmVwbGFjZSgncHgnLCAnJykpLFxuICAgICAgICAgIE51bWJlcih0aGlzLnNlbGVjdGlvbi5zdHlsZSgnaGVpZ2h0JykucmVwbGFjZSgncHgnLCAnJykpLFxuICAgICAgICAgIGZvcm1hdCxcbiAgICAgICAgICAoaW1nKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNhdmUuZW1pdChpbWcpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEZvcm1hdFR5cGUuU3ZnOlxuICAgICAgICBjb25zdCBpbWdTcmMgPSAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3ZnU3RyaW5nKSkpO1xuICAgICAgICB0aGlzLmRvd25sb2FkKGltZ1NyYywgbmFtZSk7XG4gICAgICAgIHRoaXMuc2F2ZS5lbWl0KGltZ1NyYyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhpcy5zdmdTdHJpbmcySW1hZ2UoXG4gICAgICAgICAgc3ZnU3RyaW5nLFxuICAgICAgICAgIE51bWJlcih0aGlzLnNlbGVjdGlvbi5zdHlsZSgnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKSksXG4gICAgICAgICAgTnVtYmVyKHRoaXMuc2VsZWN0aW9uLnN0eWxlKCdoZWlnaHQnKS5yZXBsYWNlKCdweCcsICcnKSksXG4gICAgICAgICAgZm9ybWF0LFxuICAgICAgICAgIChpbWcpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZG93bmxvYWQoaW1nLCBuYW1lKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZS5lbWl0KGltZyk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVuZG9EcmF3KCkge1xuICAgIGlmICghdGhpcy51bmRvU3RhY2subGVuZ3RoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucmVkb1N0YWNrLnB1c2godGhpcy51bmRvU3RhY2sucG9wKCkpO1xuICAgIHRoaXMuc2VsZWN0aW9uLnNlbGVjdEFsbCgnLmxpbmUnKS5yZW1vdmUoKTtcbiAgICB0aGlzLnVuZG9TdGFjay5mb3JFYWNoKChhY3Rpb24pID0+IHtcbiAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gQWN0aW9uVHlwZS5MaW5lKSB7XG4gICAgICAgIHRoaXMuZHJhd0xpbmUoYWN0aW9uLmxpbmUpO1xuICAgICAgfSBlbHNlIGlmIChhY3Rpb24udHlwZSA9PT0gQWN0aW9uVHlwZS5JbWFnZSkge1xuICAgICAgICB0aGlzLmRyYXdMaW5lKGFjdGlvbi5pbWFnZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy51bmRvLmVtaXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVkb0RyYXcoKSB7XG4gICAgaWYgKCF0aGlzLnJlZG9TdGFjay5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy51bmRvU3RhY2sucHVzaCh0aGlzLnJlZG9TdGFjay5wb3AoKSk7XG4gICAgdGhpcy5zZWxlY3Rpb24uc2VsZWN0QWxsKCcubGluZScpLnJlbW92ZSgpO1xuICAgIHRoaXMudW5kb1N0YWNrLmZvckVhY2goKGFjdGlvbikgPT4ge1xuICAgICAgaWYgKGFjdGlvbi50eXBlID09PSBBY3Rpb25UeXBlLkxpbmUpIHtcbiAgICAgICAgdGhpcy5kcmF3TGluZShhY3Rpb24ubGluZSk7XG4gICAgICB9IGVsc2UgaWYgKGFjdGlvbi50eXBlID09PSBBY3Rpb25UeXBlLkltYWdlKSB7XG4gICAgICAgIHRoaXMuZHJhd0xpbmUoYWN0aW9uLmltYWdlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnJlZG8uZW1pdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBkcmF3TGluZShwYXRoTm9kZTogU1ZHUGF0aEVsZW1lbnQgfCBTVkdHRWxlbWVudCkge1xuICAgIHRoaXMuc2VsZWN0aW9uLm5vZGUoKS5hcHBlbmRDaGlsZChwYXRoTm9kZSk7XG4gIH1cblxuICBwcml2YXRlIGRyYXdJbWFnZShpbWFnZTogc3RyaW5nIHwgQXJyYXlCdWZmZXIpIHtcbiAgICBjb25zdCBncm91cCA9IHRoaXMuc2VsZWN0aW9uXG4gICAgICAuYXBwZW5kKCdnJylcbiAgICAgIC5kYXRhKFt7IHg6IDIwLCB5OiAyMCwgcjogMSwgc2NhbGU6IDEgfV0pXG4gICAgICAuYXR0cigneCcsIDApXG4gICAgICAuYXR0cigneScsIDApXG4gICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLDApJyk7XG5cbiAgICBjb25zdCB0ZW1wSW1nID0gbmV3IEltYWdlKCk7XG4gICAgdGVtcEltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICBjb25zdCBhc3BlY3RSYXRpbyA9IHRlbXBJbWcud2lkdGggLyB0ZW1wSW1nLmhlaWdodDtcbiAgICAgIGNvbnN0IGhlaWdodCA9XG4gICAgICAgIHRlbXBJbWcuaGVpZ2h0ID4gTnVtYmVyKHRoaXMuc2VsZWN0aW9uLnN0eWxlKCdoZWlnaHQnKS5yZXBsYWNlKCdweCcsICcnKSlcbiAgICAgICAgICA/IE51bWJlcih0aGlzLnNlbGVjdGlvbi5zdHlsZSgnaGVpZ2h0JykucmVwbGFjZSgncHgnLCAnJykpIC0gNDBcbiAgICAgICAgICA6IHRlbXBJbWcuaGVpZ2h0O1xuICAgICAgY29uc3Qgd2lkdGggPVxuICAgICAgICBoZWlnaHQgPT09IE51bWJlcih0aGlzLnNlbGVjdGlvbi5zdHlsZSgnaGVpZ2h0JykucmVwbGFjZSgncHgnLCAnJykpIC0gNDBcbiAgICAgICAgICA/IChOdW1iZXIodGhpcy5zZWxlY3Rpb24uc3R5bGUoJ2hlaWdodCcpLnJlcGxhY2UoJ3B4JywgJycpKSAtIDQwKSAqIGFzcGVjdFJhdGlvXG4gICAgICAgICAgOiB0ZW1wSW1nLndpZHRoO1xuICAgICAgZ3JvdXBcbiAgICAgICAgLmFwcGVuZCgnaW1hZ2UnKVxuICAgICAgICAuYXR0cigneCcsIDApXG4gICAgICAgIC5hdHRyKCd5JywgMClcbiAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodClcbiAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgIC5hdHRyKCdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ25vbmUnKVxuICAgICAgICAuYXR0cigneGxpbms6aHJlZicsIGltYWdlLnRvU3RyaW5nKCkpO1xuXG4gICAgICBncm91cFxuICAgICAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgLmF0dHIoJ3gnLCAwKVxuICAgICAgICAuYXR0cigneScsIDApXG4gICAgICAgIC5hdHRyKCd3aWR0aCcsIDIwKVxuICAgICAgICAuYXR0cignaGVpZ2h0JywgMjApXG4gICAgICAgIC5zdHlsZSgnb3BhY2l0eScsIDApXG4gICAgICAgIC5hdHRyKCdmaWxsJywgKGQpID0+IHtcbiAgICAgICAgICByZXR1cm4gJyNjY2NjY2MnO1xuICAgICAgICB9KVxuICAgICAgICAuY2FsbChcbiAgICAgICAgICBkcmFnKClcbiAgICAgICAgICAgIC5zdWJqZWN0KCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgcCA9IFtldmVudC54LCBldmVudC55XTtcbiAgICAgICAgICAgICAgcmV0dXJuIFtwLCBwXTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ3N0YXJ0JywgKCkgPT4ge1xuICAgICAgICAgICAgICBldmVudC5vbignZHJhZycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gc2VsZWN0KHRoaXMpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvcmQgPSBtb3VzZSh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGQueCArPSBjb3JkWzBdIC0gTnVtYmVyKGN1cnNvci5hdHRyKCd3aWR0aCcpKSAvIDI7XG4gICAgICAgICAgICAgICAgZC55ICs9IGNvcmRbMV0gLSBOdW1iZXIoY3Vyc29yLmF0dHIoJ2hlaWdodCcpKSAvIDI7XG4gICAgICAgICAgICAgICAgc2VsZWN0KHRoaXMucGFyZW50Tm9kZSkuYXR0cigndHJhbnNmb3JtJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zbGF0ZSgnICsgW2QueCwgZC55XSArICcpLHJvdGF0ZSgnICsgMCArICcsMTYwLCAxNjApLHNjYWxlKCcgKyBkLnNjYWxlICsgJywnICsgZC5zY2FsZSArICcpJ1xuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgZ3JvdXBcbiAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2VsZWN0KHRoaXMpLnNlbGVjdCgncmVjdCcpLnN0eWxlKCdvcGFjaXR5JywgMS4wKTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzZWxlY3QodGhpcykuc2VsZWN0KCdyZWN0Jykuc3R5bGUoJ29wYWNpdHknLCAwKTtcbiAgICAgICAgfSk7XG4gICAgICAvLyB0aGlzLnVuZG9TdGFjay5wdXNoKHsgdHlwZTogQWN0aW9uVHlwZS5JbWFnZSwgaW1hZ2U6IGdyb3VwLm5vZGUoKSB9KTtcbiAgICB9O1xuICAgIHRlbXBJbWcuc3JjID0gaW1hZ2UudG9TdHJpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgX3Vuc3Vic2NyaWJlKHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uKTogdm9pZCB7XG4gICAgaWYgKHN1YnNjcmlwdGlvbikge1xuICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdmdTdHJpbmcySW1hZ2UoXG4gICAgc3ZnU3RyaW5nOiBzdHJpbmcsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgICBmb3JtYXQ6IHN0cmluZyxcbiAgICBjYWxsYmFjazogKGltZzogc3RyaW5nKSA9PiB2b2lkXG4gICkge1xuICAgIC8vIHNldCBkZWZhdWx0IGZvciBmb3JtYXQgcGFyYW1ldGVyXG4gICAgZm9ybWF0ID0gZm9ybWF0IHx8ICdwbmcnO1xuICAgIC8vIFNWRyBkYXRhIFVSTCBmcm9tIFNWRyBzdHJpbmdcbiAgICBjb25zdCBzdmdEYXRhID0gJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN2Z1N0cmluZykpKTtcbiAgICAvLyBjcmVhdGUgY2FudmFzIGluIG1lbW9yeShub3QgaW4gRE9NKVxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIC8vIGdldCBjYW52YXMgY29udGV4dCBmb3IgZHJhd2luZyBvbiBjYW52YXNcbiAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgLy8gc2V0IGNhbnZhcyBzaXplXG4gICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAvLyBjcmVhdGUgaW1hZ2UgaW4gbWVtb3J5KG5vdCBpbiBET00pXG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAvLyBsYXRlciB3aGVuIGltYWdlIGxvYWRzIHJ1biB0aGlzXG4gICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgLy8gYXN5bmMgKGhhcHBlbnMgbGF0ZXIpXG4gICAgICAvLyBjbGVhciBjYW52YXNcbiAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgLy8gZHJhdyBpbWFnZSB3aXRoIFNWRyBkYXRhIHRvIGNhbnZhc1xuICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgLy8gc25hcHNob3QgY2FudmFzIGFzIHBuZ1xuICAgICAgY29uc3QgcG5nRGF0YSA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlLycgKyBmb3JtYXQpO1xuICAgICAgLy8gcGFzcyBwbmcgZGF0YSBVUkwgdG8gY2FsbGJhY2tcbiAgICAgIGNhbGxiYWNrKHBuZ0RhdGEpO1xuICAgIH07IC8vIGVuZCBhc3luY1xuICAgIC8vIHN0YXJ0IGxvYWRpbmcgU1ZHIGRhdGEgaW50byBpbiBtZW1vcnkgaW1hZ2VcbiAgICBpbWFnZS5zcmMgPSBzdmdEYXRhO1xuICB9XG5cbiAgcHJpdmF0ZSBzYXZlQXNTdmcoc3ZnTm9kZSk6IHN0cmluZyB7XG4gICAgc3ZnTm9kZS5zZXRBdHRyaWJ1dGUoJ3hsaW5rJywgJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnKTtcblxuICAgIC8vIFNldCB3aWR0aCBhbmQgaGVpZ2h0IGZvciBzdmcgZWxlbWVudFxuICAgIHN2Z05vZGUuc2V0QXR0cmlidXRlKCd3aWR0aCcsIE51bWJlcih0aGlzLnNlbGVjdGlvbi5zdHlsZSgnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKSkpO1xuICAgIHN2Z05vZGUuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBOdW1iZXIodGhpcy5zZWxlY3Rpb24uc3R5bGUoJ2hlaWdodCcpLnJlcGxhY2UoJ3B4JywgJycpKSk7XG5cbiAgICBjb25zdCBzZXJpYWxpemVyID0gbmV3IFhNTFNlcmlhbGl6ZXIoKTtcbiAgICBsZXQgc3ZnU3RyaW5nID0gc2VyaWFsaXplci5zZXJpYWxpemVUb1N0cmluZyhzdmdOb2RlKTtcbiAgICBzdmdTdHJpbmcgPSBzdmdTdHJpbmcucmVwbGFjZSgvKFxcdyspPzo/eGxpbms9L2csICd4bWxuczp4bGluaz0nKTsgLy8gRml4IHJvb3QgeGxpbmsgd2l0aG91dCBuYW1lc3BhY2VcbiAgICBzdmdTdHJpbmcgPSBzdmdTdHJpbmcucmVwbGFjZSgvTlNcXGQrOmhyZWYvZywgJ3hsaW5rOmhyZWYnKTtcbiAgICByZXR1cm4gc3ZnU3RyaW5nO1xuICB9XG5cbiAgcHJpdmF0ZSBkb3dubG9hZCh1cmw6IHN0cmluZywgbmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBsaW5rLmhyZWYgPSB1cmw7XG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgbGluay5kb3dubG9hZCA9IG5hbWUgfHwgJ25ldyB3aGl0ZS1ib2FyZCc7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTtcbiAgICBsaW5rLmNsaWNrKCk7XG4gIH1cbn1cbiJdfQ==